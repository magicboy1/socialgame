import { motion } from "framer-motion";
import { CheckCircle2, XCircle, Sparkles, Star } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Mascot } from "./Mascot";

interface FeedbackScreenProps {
  isCorrect: boolean;
  tip: string;
  onContinue: () => void;
  currentQuestion: number;
  totalQuestions: number;
}

const encouragingMessages = {
  correct: [
    "Ø£Ù†Øª Ù†Ø¬Ù… Ø§Ù„Ø£Ù…Ø§Ù†!",
    "Ø§Ø®ØªÙŠØ§Ø± Ø±Ø§Ø¦Ø¹!",
    "Ø£ØµØ¨Ø­Øª Ø®Ø¨ÙŠØ±Ø§Ù‹ ÙÙŠ Ø§Ù„Ø£Ù…Ø§Ù†!",
    "Ù…Ù…ØªØ§Ø²! Ø§Ø³ØªÙ…Ø±!",
  ],
  incorrect: [
    "Ù„Ø§ Ø¨Ø£Ø³! Ø§Ù„ØªØ¹Ù„Ù… Ù…Ù‡Ù…!",
    "Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬ÙŠØ¯Ø©! Ø¯Ø¹Ù†Ø§ Ù†ØªØ¹Ù„Ù… Ù…Ø¹Ø§Ù‹!",
    "Ù„Ø§ ØªÙ‚Ù„Ù‚! Ø§Ù„Ø¢Ù† Ø£Ù†Øª ØªØ¹Ø±Ù!",
  ],
};

export function FeedbackScreen({ isCorrect, tip, onContinue, currentQuestion, totalQuestions }: FeedbackScreenProps) {
  const mascotMessage = isCorrect
    ? encouragingMessages.correct[Math.floor(Math.random() * encouragingMessages.correct.length)]
    : encouragingMessages.incorrect[Math.floor(Math.random() * encouragingMessages.incorrect.length)];

  return (
    <motion.div
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      className="min-h-screen relative overflow-hidden flex items-center justify-center p-4 sm:p-6"
      style={{ 
        background: isCorrect 
          ? 'linear-gradient(135deg, hsl(145, 65%, 15%) 0%, hsl(145, 50%, 8%) 100%)'
          : 'linear-gradient(135deg, hsl(0, 75%, 15%) 0%, hsl(0, 60%, 8%) 100%)'
      }}
      data-testid="feedback-screen"
    >
      {/* Animated spotlight beams */}
      <div className="spotlight-beam" style={{ 
        background: isCorrect 
          ? 'linear-gradient(90deg, transparent, hsl(145 65% 45% / 0.2), transparent)'
          : 'linear-gradient(90deg, transparent, hsl(0 75% 45% / 0.2), transparent)'
      }} />
      
      {/* Celebration particles */}
      {isCorrect && Array.from({ length: 30 }).map((_, i) => (
        <motion.div
          key={i}
          className="absolute"
          initial={{ scale: 0, x: '50vw', y: '50vh' }}
          animate={{
            scale: [0, 1, 1],
            x: `${Math.random() * 100}vw`,
            y: `${Math.random() * 100}vh`,
            opacity: [1, 1, 0],
          }}
          transition={{
            duration: 2,
            delay: i * 0.05,
            ease: "easeOut",
          }}
        >
          <Star className="w-4 h-4 sm:w-6 sm:h-6 fill-[hsl(165,75%,50%)] text-[hsl(165,75%,50%)]" />
        </motion.div>
      ))}

      <div className="relative z-10 w-[min(90vw,75rem)]">
        <div className="card-dramatic rounded-2xl sm:rounded-3xl p-6 sm:p-8 md:p-12 lg:p-14 2xl:p-16" style={{ gap: 'clamp(1.5rem, 2vw, 3rem)' }}>
          <div className="flex flex-col items-center text-center" style={{ gap: 'clamp(1.5rem, 2vw, 3rem)' }}>
            
            {/* Icon */}
            <motion.div
              initial={{ scale: 0, rotate: isCorrect ? -180 : 180 }}
              animate={{ scale: 1, rotate: 0 }}
              transition={{
                type: "spring",
                stiffness: 200,
                damping: 15,
              }}
            >
              {isCorrect ? (
                <div className="relative">
                  <CheckCircle2 
                    style={{ 
                      color: 'hsl(145, 65%, 45%)',
                      width: 'clamp(5rem, 8vw, 10rem)',
                      height: 'clamp(5rem, 8vw, 10rem)',
                    }} 
                    strokeWidth={2.5} 
                  />
                  <motion.div
                    className="absolute inset-0"
                    animate={{ scale: [1, 1.2, 1], rotate: [0, 180, 360] }}
                    transition={{ duration: 2, repeat: Infinity }}
                  >
                    <Sparkles 
                      className="absolute -top-2 -right-2" 
                      style={{ 
                        color: 'hsl(165, 75%, 50%)',
                        width: 'clamp(2.5rem, 3vw, 3.5rem)',
                        height: 'clamp(2.5rem, 3vw, 3.5rem)',
                      }} 
                    />
                  </motion.div>
                </div>
              ) : (
                <XCircle 
                  style={{ 
                    color: 'hsl(0, 75%, 45%)',
                    width: 'clamp(5rem, 8vw, 10rem)',
                    height: 'clamp(5rem, 8vw, 10rem)',
                  }} 
                  strokeWidth={2.5} 
                />
              )}
            </motion.div>

            {/* Title */}
            <motion.div
              initial={{ y: 20, opacity: 0 }}
              animate={{ y: 0, opacity: 1 }}
              transition={{ delay: 0.2 }}
            >
              <h2
                className="font-black"
                style={{
                  fontSize: 'clamp(1.875rem, 3vw + 1rem, 5rem)',
                  marginBottom: 'clamp(0.75rem, 1vw, 1.5rem)',
                  color: isCorrect ? 'hsl(145, 65%, 55%)' : 'hsl(0, 75%, 55%)',
                  textShadow: '0 0 30px currentColor, 4px 4px 0px rgba(0, 0, 0, 0.8)'
                }}
                data-testid="text-feedback-title"
              >
                {isCorrect ? "Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! ğŸ‰" : "Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø© ğŸ˜”"}
              </h2>
              
              <p 
                className="font-bold text-brand"
                style={{
                  fontSize: 'clamp(1rem, 1.5vw + 0.5rem, 2rem)',
                }}
              >
                {mascotMessage}
              </p>
            </motion.div>

            {/* Tip */}
            <motion.div
              initial={{ y: 20, opacity: 0 }}
              animate={{ y: 0, opacity: 1 }}
              transition={{ delay: 0.4 }}
              className="w-full"
            >
              <div
                className="rounded-xl sm:rounded-2xl"
                style={{
                  padding: 'clamp(1.5rem, 2.5vw, 3rem)',
                  background: 'rgba(20, 25, 45, 0.6)',
                  border: `3px solid ${isCorrect ? 'hsl(145, 65%, 45%)' : 'hsl(0, 75%, 45%)'}`,
                  boxShadow: `0 0 40px ${isCorrect ? 'hsl(145 65% 45% / 0.3)' : 'hsl(0 75% 45% / 0.3)'}`,
                }}
              >
                <h3 
                  className="font-black text-brand"
                  style={{
                    fontSize: 'clamp(1.25rem, 2vw + 0.5rem, 2.5rem)',
                    marginBottom: 'clamp(0.75rem, 1vw, 1.5rem)',
                  }}
                >
                  {isCorrect ? "Ù„Ù…Ø§Ø°Ø§ Ù‡Ø°Ø§ ØµØ­ÙŠØ­ØŸ" : "Ù„Ù…Ø§Ø°Ø§ Ù‡Ø°Ø§ Ø®Ø·Ø£ØŸ"}
                </h3>
                <p
                  className="font-bold leading-relaxed text-white text-right"
                  data-testid="text-tip"
                  dir="rtl"
                  style={{
                    fontSize: 'clamp(1rem, 1.5vw + 0.5rem, 2rem)',
                  }}
                >
                  {tip}
                </p>
              </div>
            </motion.div>

            {/* Continue Button */}
            <motion.div
              initial={{ y: 20, opacity: 0 }}
              animate={{ y: 0, opacity: 1 }}
              transition={{ delay: 0.6 }}
              className="w-full flex flex-col items-center"
              style={{ gap: 'clamp(0.75rem, 1vw, 1.5rem)' }}
            >
              <p 
                className="font-bold text-brand"
                style={{
                  fontSize: 'clamp(0.875rem, 1vw + 0.25rem, 1.5rem)',
                }}
              >
                Ø§Ù„Ø³Ø¤Ø§Ù„ {currentQuestion} Ù…Ù† {totalQuestions}
              </p>
              <Button
                onClick={onContinue}
                size="lg"
                className="btn-brand font-black rounded-xl sm:rounded-2xl w-full sm:w-auto"
                data-testid="button-continue"
                style={{ 
                  direction: 'rtl',
                  height: 'clamp(3.5rem, 5vw, 5rem)',
                  padding: '0 clamp(2rem, 4vw, 4rem)',
                  fontSize: 'clamp(1rem, 1.5vw + 0.5rem, 2rem)',
                }}
              >
                {currentQuestion < totalQuestions ? 'Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ' : 'Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©'}
              </Button>
            </motion.div>
          </div>
        </div>
      </div>
    </motion.div>
  );
}
