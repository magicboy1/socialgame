import { motion } from "framer-motion";
import type { Question } from "@shared/schema";
import { Check, X } from "lucide-react";

interface MultipleChoiceQuestionProps {
  question: Question;
  onAnswer: (choiceNumber: number) => void;
  selectedAnswer: number | null;
  showResult: boolean;
  isCorrect: boolean | null;
  disabled: boolean;
}

const choiceLetters = ["أ", "ب", "ج", "د"];

export function MultipleChoiceQuestion({
  question,
  onAnswer,
  selectedAnswer,
  showResult,
  isCorrect,
  disabled,
}: MultipleChoiceQuestionProps) {
  const choices = [
    { number: 1, text: question.choice1 },
    { number: 2, text: question.choice2 },
    { number: 3, text: question.choice3 },
    { number: 4, text: question.choice4 },
  ];

  const getButtonClass = (choiceNumber: number) => {
    const baseClass = "btn-choice w-full rounded-lg sm:rounded-xl lg:rounded-2xl flex items-center gap-3 sm:gap-4 lg:gap-6 px-4 sm:px-6 md:px-8 lg:px-10 2xl:px-12 text-right";
    
    if (!showResult) {
      return baseClass;
    }
    
    if (choiceNumber === question.correctAnswer) {
      return `${baseClass} btn-choice-correct`;
    }
    
    if (selectedAnswer === choiceNumber && !isCorrect) {
      return `${baseClass} btn-choice-wrong`;
    }
    
    return baseClass;
  };

  return (
    <div className="w-[min(90vw,80rem)] mx-auto px-4 sm:px-6 lg:px-8 2xl:px-12" dir="rtl">
      {/* Question Card */}
      <motion.div
        initial={{ opacity: 0, y: -30 }}
        animate={{ opacity: 1, y: 0 }}
        className="card-dramatic rounded-2xl sm:rounded-3xl p-6 sm:p-8 md:p-12 lg:p-14 2xl:p-16 mb-6 sm:mb-8 lg:mb-10 2xl:mb-12"
        data-testid="question-card"
      >
        <p 
          className="font-bold text-white text-center leading-relaxed"
          style={{
            fontSize: 'clamp(1.125rem, 1.5vw + 0.75rem, 3.5rem)',
            textShadow: '0 0 20px rgba(45, 200, 140, 0.3), 2px 2px 8px rgba(0, 0, 0, 0.8)',
          }}
        >
          {question.scenario}
        </p>
      </motion.div>

      {/* Choice Buttons */}
      <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 md:gap-6 lg:gap-8 2xl:gap-10">
        {choices.map((choice, index) => (
          <motion.button
            key={choice.number}
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: index * 0.1 }}
            onClick={() => !disabled && !showResult && onAnswer(choice.number)}
            disabled={disabled || showResult}
            className={getButtonClass(choice.number)}
            data-testid={`choice-${choice.number}`}
            style={{
              height: 'clamp(4rem, 4vw, 6.5rem)',
            }}
          >
            {/* Letter Circle */}
            <div 
              className="flex-shrink-0 rounded-full flex items-center justify-center font-black border-2 sm:border-3"
              style={{
                width: 'clamp(2.5rem, 3vw, 4rem)',
                height: 'clamp(2.5rem, 3vw, 4rem)',
                fontSize: 'clamp(1.125rem, 1.2vw, 1.75rem)',
                background: 'linear-gradient(135deg, hsl(165 75% 50%), hsl(165 80% 40%))',
                color: 'hsl(230 35% 7%)',
                borderColor: 'hsl(165 70% 65%)',
                boxShadow: '0 0 15px rgba(45, 200, 140, 0.4)',
              }}
            >
              {choiceLetters[index]}
            </div>

            {/* Choice Text */}
            <span 
              className="flex-1 font-semibold text-white"
              style={{
                fontSize: 'clamp(0.875rem, 1.2vw + 0.5rem, 2rem)',
              }}
            >
              {choice.text}
            </span>

            {/* Result Icon */}
            {showResult && choice.number === question.correctAnswer && (
              <motion.div
                initial={{ scale: 0 }}
                animate={{ scale: 1 }}
                transition={{ type: "spring", stiffness: 200 }}
              >
                <Check 
                  className="text-green-400" 
                  strokeWidth={3}
                  style={{
                    width: 'clamp(1.5rem, 2vw, 2.5rem)',
                    height: 'clamp(1.5rem, 2vw, 2.5rem)',
                  }}
                />
              </motion.div>
            )}

            {showResult && selectedAnswer === choice.number && !isCorrect && (
              <motion.div
                initial={{ scale: 0 }}
                animate={{ scale: 1 }}
                transition={{ type: "spring", stiffness: 200 }}
              >
                <X 
                  className="text-red-400" 
                  strokeWidth={3}
                  style={{
                    width: 'clamp(1.5rem, 2vw, 2.5rem)',
                    height: 'clamp(1.5rem, 2vw, 2.5rem)',
                  }}
                />
              </motion.div>
            )}
          </motion.button>
        ))}
      </div>
    </div>
  );
}
